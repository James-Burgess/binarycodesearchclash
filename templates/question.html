<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>question</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dark.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
    <style>
        .editor {
            background: #222;
            border-radius: 6px;
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            font-family: "Source Code Pro", monospace;
            font-size: 14px;
            font-weight: 400;
            min-height: 340px;
            letter-spacing: normal;
            line-height: 20px;
            padding: 10px;
            tab-size: 4;
        }
    </style>
</head>
<body>
<h1>{{ question.name }}</h1>
<p>{{ question.description }}</p>
<h3>Test questions</h3>
{% for test in question.questions %}
<h4>Test {{ loop.index }}</h4>
<p>INPUT: {{ test.input }}</p>
<p>ANSWER: {{ test.answer }}</p>
{% endfor %}


<form id="form" onsumbit="event.preventDefault()">
    <input type="text" id="username" name="username" placeholder="username">
    <select name="language" id="language" onchange="updateCode()">
      <option value="python">Python3</option>
      <option value="javascript">Javascript</option>
    </select>
<!--    <textarea id="code" name="code" rows="4" cols="50">-->
<!--class UserSolution(Soln):-->
<!--    def solve(self, a, b):-->
<!--        return "answer"-->
<!--    </textarea>-->
    <div class="editor">
    </div>

    <button onclick="testCode(event)">Test</button>
    <button onclick="submitCode(event)">Submit</button>
</form>
<div id="output">


</div>

<script type="module">
  import {CodeJar} from "https://cdn.jsdelivr.net/npm/@medv/codejar@1.0.6/codejar.js"
  import {withLineNumbers} from "https://cdn.jsdelivr.net/npm/@medv/codejar@1.0.6/linenumbers.js"

  const editor = document.querySelector(".editor")

  const highlight = editor => {
    editor.textContent = editor.textContent
    hljs.highlightBlock(editor)
  }

  const jar = new CodeJar(editor, withLineNumbers(highlight),{
    tab: "  "
  })

  function updateCode() {
    let lang = document.querySelector('#language').value
    jar.updateCode(
      {
        python: `class UserSolution(Soln):
    def solve(self, a, b):
        return "answer"`,
        javascript: `class UserSolution extends Soln {
  solve(a, b) {
    return 'answer'
  }
}`,
      }[lang])

  }
  updateCode();

  window.updateCode = updateCode
  window.jar = jar
</script>
<script>

    function getData(){
        let elements = document.querySelector('#form').elements
        let obj = {};
        for(let i = 0 ; i < elements.length ; i++){
            var item = elements.item(i);
            obj[item.name] = item.value;
        }
        obj['code'] = jar.toString()
        return obj
    }

    function testCode(e){
        e.preventDefault();
        const obj = getData();

        fetch('test/', {
            method: 'post',
            headers: {
             'Content-Type': 'application/json'
            },
            body: JSON.stringify(obj)
        })
        .then(r => r.json())
        .then(r => {
            let html = ''
            console.log(r)
            for (let line of r.STDOUT) {
                html += `<p>${line}</p>`
            }
            document.querySelector('#output').innerHTML = html
        })
        .catch(e => alert(e))
    }
    function submitCode(e){
        e.preventDefault();
                const obj = getData();

        fetch('submit/', {
            method: 'post',
            headers: {
             'Content-Type': 'application/json'
            },
            body: JSON.stringify(obj)
        })
        .then(r => window.location.href = 'leaderboard/')
        .catch(e => alert(e))
    }
</script>
</body>
</html>
